<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat Operador Virtual - Conversor</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<style>

/* Reset básico y tipografía */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #121212;
  color: #e0e0e0;
  display: flex;
  justify-content: center;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 700px;
  width: 100%;
  background-color: #1e1e1e;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
  display: flex;
  flex-direction: column;
  height: 90vh;
}

header {
  background-color: #272727;
  padding: 15px 20px;
  border-radius: 8px 8px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  font-size: 1.4rem;
  font-weight: 700;
}

#btnBack {
  background-color: #007acc;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.3s ease;
}

#btnBack:hover,
#btnBack:focus {
  background-color: #005f99;
  outline: none;
}

main#chatWindow {
  flex-grow: 1;
  padding: 20px;
  overflow-y: auto;
  background-color: #121212;
  border-top: 1px solid #333;
  border-bottom: 1px solid #333;
}

/* Mensajes */
.message {
  margin-bottom: 12px;
  position: relative;
  max-width: 80%;
  padding: 10px 14px;
  border-radius: 12px;
  word-wrap: break-word;
  font-size: 1rem;
  line-height: 1.3;
  user-select: text;
}

.message.user {
  background-color: #005f99;
  color: #e0e0e0;
  align-self: flex-end;
  border-bottom-right-radius: 0;
}

.message.operator {
  background-color: #333;
  color: #ddd;
  align-self: flex-start;
  border-bottom-left-radius: 0;
}

/* Botón para borrar mensaje individual */
.message button.deleteBtn {
  position: absolute;
  top: 6px;
  right: 6px;
  background: transparent;
  border: none;
  color: #ff5555;
  font-weight: 700;
  cursor: pointer;
  font-size: 0.8rem;
  padding: 0 5px;
  border-radius: 3px;
  transition: color 0.3s ease;
}

.message button.deleteBtn:hover,
.message button.deleteBtn:focus {
  color: #ff2222;
  outline: none;
}

/* Formulario de chat */
form#chatForm {
  display: flex;
  border-top: 1px solid #333;
  background-color: #1e1e1e;
  padding: 10px 15px;
  gap: 10px;
  border-radius: 0 0 8px 8px;
}

form#chatForm input[type='text'] {
  flex-grow: 1;
  padding: 10px 15px;
  font-size: 1rem;
  border-radius: 5px;
  border: none;
  outline: none;
  background-color: #333;
  color: #e0e0e0;
  transition: background-color 0.3s ease;
}

form#chatForm input[type='text']:focus {
  background-color: #444;
}

form#chatForm button {
  background-color: #007acc;
  border: none;
  color: #fff;
  font-weight: 600;
  padding: 10px 18px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

form#chatForm button:hover,
form#chatForm button:focus {
  background-color: #005f99;
  outline: none;
}

/* Sección para añadir preguntas y respuestas */
#addQASection {
  background-color: #272727;
  padding: 15px 20px;
  margin-top: 15px;
  border-radius: 8px;
}

#addQASection h2 {
  margin-bottom: 10px;
  font-size: 1.2rem;
}

form#addQAForm {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

form#addQAForm input[type='text'] {
  flex-grow: 1;
  padding: 8px 12px;
  border-radius: 5px;
  border: none;
  background-color: #333;
  color: #e0e0e0;
  font-size: 0.9rem;
  transition: background-color 0.3s ease;
}

form#addQAForm input[type='text']:focus {
  background-color: #444;
  outline: none;
}

form#addQAForm button {
  background-color: #28a745;
  border: none;
  color: #fff;
  font-weight: 600;
  padding: 10px 18px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

form#addQAForm button:hover,
form#addQAForm button:focus {
  background-color: #1e7e34;
  outline: none;
}

/* Scroll personalizado para el chat */
main#chatWindow::-webkit-scrollbar {
  width: 8px;
}

main#chatWindow::-webkit-scrollbar-track {
  background: #1e1e1e;
}

main#chatWindow::-webkit-scrollbar-thumb {
  background-color: #007acc;
  border-radius: 10px;
}

/* Responsive */
@media (max-width: 600px) {
  form#addQAForm {
    flex-direction: column;
  }

  form#addQAForm input[type='text'],
  form#addQAForm button {
    width: 100%;
  }
}


</style>

<body>
  <div class="container">
    <header>
      <h1>Operador Virtual - Conversor</h1>
      <button id="btnBack" title="Volver al menú">← Volver al Menú</button>
    </header>

    <main id="chatWindow" aria-label="Chat de preguntas y respuestas"></main>

    <form id="chatForm" aria-label="Formulario de chat">
      <input
        type="text"
        id="userInput"
        placeholder="Escribe tu pregunta..."
        autocomplete="off"
        aria-required="true"
        maxlength="150"
        required
      />
      <button type="submit" aria-label="Enviar mensaje">Enviar</button>
    </form>

    <section id="addQASection" aria-label="Añadir preguntas y respuestas">
      <h2>Añadir Pregunta y Respuesta</h2>
      <form id="addQAForm">
        <input
          type="text"
          id="newQuestion"
          placeholder="Nueva pregunta"
          autocomplete="off"
          maxlength="150"
          required
          aria-required="true"
        />
        <input
          type="text"
          id="newAnswer"
          placeholder="Respuesta correspondiente"
          autocomplete="off"
          maxlength="300"
          required
          aria-required="true"
        />
        <button type="submit">Añadir</button>
      </form>
    </section>
  </div>

  <script>// Lista de palabras ofensivas para bloquear
const bannedWords = [
  'coño',
  'coño la madre',
  'maldito',
  'mierda',
  'desgraciado',
  'pajuo',
  'cuca',
  'culo',
  'mal parido',
  'muerte',
  'sangre',
  'maldicion',
  'pipe',
  'muerta de hambre',
  'dame culo',
'mama guevo',
'viva maduro',
'chavez vive',
'viva la patria',
'el socialismo ',
  'eres marisco',
  'mamamelo',
  'nojodas',


  // Puedes agregar más si deseas
];

// Preguntas y respuestas predefinidas
const defaultQA = {
  'publicidad': 'Nuestra aplicación muestra publicidad para mantener el servicio gratuito.',
  
  'porque no actualizo el dólar en la aplicación': 'El dólar puede no actualizarse debido a problemas con la fuente de datos o conexión.',
  'fecha bancaria': 'La aplicación muestra la fecha bancaria actualizada según el banco asociado.',
  'inicio de sección': 'Para iniciar sesión, ingresa tu usuario y contraseña en la pantalla de inicio.',
  'cuanto cuesta la aplicación': 'La aplicación es gratuita con opciones premium de pago.',
  'precio de la aplicación': 'El precio varía según el plan, desde MATH_EXPR_09.99 por mes.',
  'porque no funciona la calculadora': 'Verifica que tu conexión esté activa y que la calculadora esté actualizada.',
  'porque no funciona el calendario': 'El calendario puede estar deshabilitado temporalmente por mantenimiento.',
  'que pasa con esta aplicación': 'Estamos trabajando para mejorar la experiencia y corregir errores.',
  'quien fue el creador de esta app': 'La aplicación fue creada por un equipo de desarrolladores expertos en software.',
  'puedo publicar propagandas': 'Actualmente no permitimos publicidad externa para mantener la calidad.',
  'de donde es la aplicación': 'Esta aplicación fue desarrollada en Latinoamérica.',
  'cuando fue creada': 'La aplicación fue creada en el año 2023.',
  'como la descargo': 'Puedes descargarla desde nuestra página oficial o tiendas de aplicaciones.',
  'está en play estore': 'Sí, la aplicación está disponible en Google Play Store.',
  // 8 preguntas adicionales
  'precio del dólar' : 'dolar de hoy 273,58',
  'precio del dólar de hoy': 'el dólar de hoy cotiza en 273.58.',
  
  'cómo cambio el idioma': 'Puedes cambiar el idioma desde la configuración en la sección de ajustes.',
  'la aplicación consume muchos datos': 'La aplicación está optimizada para consumir pocos datos, pero depende del uso.',
  'cómo restablecer la contraseña': 'Puedes restablecer la contraseña desde la pantalla de inicio, opción "Olvidé mi contraseña".',
  'la calculadora da resultados erróneos': 'Por favor revisa que los datos ingresados sean correctos y actualiza la app.',
  'cómo contacto soporte': 'Puedes contactarnos a soporte@conversorapp.com o vía chat en línea.',
  'hay versión para iOS': 'Sí, próximamente lanzaremos la versión para iOS.',
  
  'qué hacer si la app se cierra sola': 'Intenta reinstalar la aplicación y borrar caché para resolver el problema.',
  
   'quien eres': 'soy un operador virtual de la plataforma de la aplicación conversor',
   
   'que haces': 'mantenerte informado en las preguntas que me agas',
   
   'tu nombre': 'me llamo operador virtual de esta aplicación me puedes llamar Noe',
   
   'quien te creo': 'disculpa no puedo darte esa información de quien creo la aplicación conversor no estoy autorizado para dar esa información.',
   
   'eres juan': 'disculpa quien es Juan ',
   
   'disculpa pense': 'ok no sigas pensando porque soy operador virtual de esta app',
   
   'disculpa': 'Disculpad@, alguna otra pregunta para ayudarte',
   
   'tengo hambre': 'valla a cocinar pues y disfrute de su comida',
   
   'eres casado': 'no soy casado no estoy diseñado para ese parentesco',
   
   'que versión eres': 'la versión de la app conversor es 1.0',
   
   'eres hombre o mujer': 'hombre y tu?',
   
   'mujer':'ok que bueno chica',
   
   'hombre': 'ok exelente amigo', 
   'dame la hora': ' te invito ver la hora en el menú de la aplicación',
   
   'hola buenas': 'hola puedo ayurte en algo?',
   
   'si quien eres': 'hola soy tu operador virtual en que te podré ayudar',
   
   'precio de una aplicación':'depende el tipo de aplicación que necesites de tu interes',
  
   'como debo publicar por esta aplicación': 'para publicar por esta app debes comunicarte con el desarrollador.',
   
   'crear publicidad': 'debes comunicarte con el desarrollador de la app para publicar alguna publicación de tu interes',
   
   'no entiendo' : 'que no entiendes para explicarte otra vez',
     
'contacto del desarrollador':'disculpa no estoy autorizado para darte el contacto del desarrollador pero intentaré comunicarme con el y proporcionarte la repuesta',
     
  'dame tu número': 'lo siento estás en mi contacto que deseabas ',
   
'color favorito': 'verde',

'buenas noches': 'buenas noches en que puedo servirte.',

'como te llamas': 'mi nombre es Noe',

'a como está el dolar hoy': 've al menú y allí está mostrada el dólar al dia',

'chao': 'gracias por escribir bienvenido cuando vuelva nuevamente hasta luego',
'hola': 'hola en que puedo ayudarte',

'cómo estas': 'bien gracias a Dios y tú?',

'quien eres': 'soy Noe ',
'que edad tienes' : 'me lo reservo',
'hasta que hora atiendes' : 'las 24 horas al día mientras este activo la app',

'eres casado': 'no estoy casado',
'no sé me actualiza la aplicación': 'estimado debe esperar que la app actualice desde la plataformao en caso que se allá actualizado borre el cache de la aplicación y la vuelve abrir nuevamente para que muestre la actualización.',

'que edad tienes': '45',
'que edad tiene': '45',
   
};

// Claves para almacenamiento local
const STORAGE_KEY_MESSAGES = 'chat_messages';
const STORAGE_KEY_QA = 'chat_qa';

const chatWindow = document.getElementById('chatWindow');
const chatForm = document.getElementById('chatForm');
const userInput = document.getElementById('userInput');
const addQAForm = document.getElementById('addQAForm');
const newQuestionInput = document.getElementById('newQuestion');
const newAnswerInput = document.getElementById('newAnswer');
const btnBack = document.getElementById('btnBack');

// Carga preguntas y respuestas desde localStorage o usa las predeterminadas
function loadQA() {
  const savedQA = localStorage.getItem(STORAGE_KEY_QA);
  if (savedQA) {
    try {
      return JSON.parse(savedQA);
    } catch {
      return { ...defaultQA };
    }
  }
  return { ...defaultQA };
}

// Guarda preguntas y respuestas en localStorage
function saveQA(qaObj) {
  localStorage.setItem(STORAGE_KEY_QA, JSON.stringify(qaObj));
}

// Carga mensajes previos desde localStorage
function loadMessages() {
  const saved = localStorage.getItem(STORAGE_KEY_MESSAGES);
  if (saved) {
    try {
      return JSON.parse(saved);
    } catch {
      return [];
    }
  }
  return [];
}

// Guarda mensajes en localStorage
function saveMessages(msgs) {
  localStorage.setItem(STORAGE_KEY_MESSAGES, JSON.stringify(msgs));
}

// Función para sanitizar texto y evitar XSS
function sanitize(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Comprueba si el mensaje contiene palabras ofensivas
function containsBannedWords(text) {
  const lowerText = text.toLowerCase();
  return bannedWords.some((word) => lowerText.includes(word));
}

// Añade un mensaje al chat y lo guarda
function addMessage(text, sender) {
  const messages = loadMessages();
  const messageObj = {
    id: Date.now(),
    sender,
    text,
  };
  messages.push(messageObj);
  saveMessages(messages);
  renderMessage(messageObj);
  scrollChatToBottom();
  return messageObj.id;
}

// Renderiza un único mensaje en el chat
function renderMessage(message) {
  const div = document.createElement('div');
  div.classList.add('message', message.sender);
  div.setAttribute('data-id', message.id);
  div.setAttribute('role', 'article');
  div.setAttribute('aria-label', `message.sender===′user′?′Usuario′:′Operadorvirtual′dijo:{message.sender === 'user' ? 'Usuario' : 'Operador virtual'} dijo:message.sender===′user′?′Usuario′:′Operadorvirtual′dijo:{message.text}`);

  div.innerHTML = `
    <span>${sanitize(message.text)}</span>
    <button aria-label="Borrar mensaje" class="deleteBtn">&times;</button>
  `;

  // Añadir evento para borrar mensaje
  div.querySelector('.deleteBtn').addEventListener('click', () => {
    deleteMessage(message.id);
  });

  chatWindow.appendChild(div);
}

// Renderiza todos los mensajes guardados al cargar
function renderMessages() {
  chatWindow.innerHTML = '';
  const messages = loadMessages();
  messages.forEach(renderMessage);
  scrollChatToBottom();
}

// Borra un mensaje individual
function deleteMessage(id) {
  let messages = loadMessages();
  messages = messages.filter((msg) => msg.id !== id);
  saveMessages(messages);
  renderMessages();
}

// Desplaza el chat al final
function scrollChatToBottom() {
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// Responde al usuario con la respuesta apropiada
function responderPregunta(text) {
  const qa = loadQA();
  const normalizedText = text.trim().toLowerCase();

  // Buscar coincidencia exacta o parcial
  let response = null;

  // Exact match
  if (qa.hasOwnProperty(normalizedText)) {
    response = qa[normalizedText];
  } else {
    // Busca pregunta que incluya la pregunta del usuario (para aproximados)
    for (const question in qa) {
      if (normalizedText.includes(question)) {
        response = qa[question];
        break;
      }
    }
  }

  if (!response) {
    response = 'Lo siento, no tengo una respuesta para esa pregunta. Por favor, intenta con otra consulta o añade una respuesta personalizada.';
  }

  return response;
}

// Maneja el envío del formulario de chat
chatForm.addEventListener('submit', (e) => {
  e.preventDefault();

  const userText = userInput.value.trim();
  if (!userText) return;

  // Bloquear palabras ofensivas
  if (containsBannedWords(userText)) {
    alert('Por favor, no uses palabras ofensivas.');
    userInput.value = '';
    return;
  }

  // Añadir mensaje del usuario
  addMessage(userText, 'user');

  // Obtener respuesta del operador virtual
  const answer = responderPregunta(userText);

  // Simular pequeña demora para respuesta
  setTimeout(() => {
    addMessage(answer, 'operator');
  }, 700);

  userInput.value = '';
});

// Maneja el envío de nuevas preguntas y respuestas
addQAForm.addEventListener('submit', (e) => {
  e.preventDefault();

  const question = newQuestionInput.value.trim().toLowerCase();
  const answer = newAnswerInput.value.trim();

  if (!question || !answer) {
    alert('Por favor, completa ambas preguntas y respuestas.');
    return;
  }

  // Bloquear palabras ofensivas en pregunta y respuesta
  if (containsBannedWords(question) || containsBannedWords(answer)) {
    alert('No se permiten palabras ofensivas en la pregunta o respuesta.');
    return;
  }

  const qa = loadQA();
  if (qa.hasOwnProperty(question)) {
    if (!confirm('La pregunta ya existe. ¿Quieres sobrescribir la respuesta?')) {
      return;
    }
  }

  qa[question] = answer;
  saveQA(qa);

  alert('Pregunta y respuesta añadidas correctamente.');

  newQuestionInput.value = '';
  newAnswerInput.value = '';
});

// Carga mensajes guardados al iniciar la página
window.addEventListener('load', () => {
  renderMessages();
});

// Botón para volver al menú.html
btnBack.addEventListener('click', () => {
  window.location.href = 'index.html';
});


</script>
</body>
</html>
