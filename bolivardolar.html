<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reproductor Clásico Windows XP - Manipulable desde index.html</title>
  <style>
    /* ===== Windows XP Classic Style ===== */
    @import url('https://fonts.googleapis.com/css2?family=Tahoma&display=swap');

    /* Reset and base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: Tahoma, Arial, sans-serif;
      background: #008080; /* Classic teal background */
      color: #000;
      user-select: none;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Loading Screen */
    #loading-screen {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      width: 250px;
      font-weight: bold;
      font-size: 1.2rem;
      background: #c0c0c0;
      border: 2px solid #000;
      padding: 15px;
      box-shadow: 3px 3px 0 #fff inset, -3px -3px 0 #404040 inset;
      border-radius: 4px;
      z-index: 1000;
    }
    #loading-bar {
      width: 100%;
      height: 20px;
      background: #fff;
      border: 1px solid #000;
      margin-bottom: 8px;
      position: relative;
      box-shadow: inset 1px 1px 0 #fff, inset -1px -1px 0 #404040;
      border-radius: 2px;
      overflow: hidden;
    }
    #loading-progress {
      height: 100%;
      width: 0;
      background: #000080;
      box-shadow:
        1px 1px 0 #fff inset,
        -1px -1px 0 #404040 inset;
      transition: width 0.3s ease;
    }

    /* Main container hidden initially */
    #app {
      display: none;
      max-width: 640px;
      width: 90vw;
      background: #c0c0c0;
      border: 2px solid #000;
      box-shadow:
        3px 3px 0 #fff inset,
        -3px -3px 0 #404040 inset;
      border-radius: 4px;
      padding: 8px;
      box-sizing: border-box;
      user-select: text;
      flex-direction: column;
      display: flex;
    }

    /* Title bar */
    #title-bar {
      background: linear-gradient(to bottom, #000080, #0000cd);
      color: #fff;
      padding: 4px 8px;
      font-weight: bold;
      font-size: 1rem;
      box-shadow: inset 1px 1px 0 #fff, inset -1px -1px 0 #404040;
      border-radius: 2px;
      margin-bottom: 8px;
      user-select: none;
    }

    /* Video container */
    #video-container {
      position: relative;
      background: black;
      border: 2px solid #000080;
      box-shadow:
        3px 3px 0 #fff inset,
        -3px -3px 0 #404040 inset;
      border-radius: 4px;
      overflow: hidden;
      aspect-ratio: 16 / 9;
      max-height: 360px;
      /* mobile-friendly */
      width: 100%;
      margin-bottom: 8px;
    }

    video {
      width: 100%;
      height: 100%;
      background: black;
      display: block;
    }

    /* Controls Bar */
    #controls {
      background: #c0c0c0;
      border: 2px solid #000;
      box-shadow:
        3px 3px 0 #fff inset,
        -3px -3px 0 #404040 inset;
      border-radius: 4px;
      padding: 8px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    button, input[type="range"], input[type="color"] {
      cursor: pointer;
      background: #e0e0e0;
      border: 2px outset #fff;
      box-shadow:
        1px 1px 0 #fff inset,
        -1px -1px 0 #404040 inset;
      font-size: 0.9rem;
      padding: 4px 8px;
      border-radius: 2px;
      transition: all 0.1s ease-in-out;
      user-select: none;
    }
    button:active {
      border-style: inset;
      box-shadow:
        -1px -1px 0 #fff inset,
        1px 1px 0 #404040 inset;
    }
    input[type="range"] {
      -webkit-appearance: none;
      height: 16px;
      background: #e0e0e0;
      border-radius: 4px;
      flex-grow: 1;
      max-width: 150px;
      margin: 0 4px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #000080;
      border-radius: 2px;
      cursor: pointer;
      border: 1px solid #000;
      box-shadow:
        1px 1px 0 #fff inset,
        -1px -1px 0 #404040 inset;
      margin-top: -5px;
      position: relative;
      z-index: 1;
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #000080;
      border-radius: 2px;
      cursor: pointer;
      border: 1px solid #000;
      box-shadow:
        1px 1px 0 #fff inset,
        -1px -1px 0 #404040 inset;
      position: relative;
      z-index: 1;
    }

    /* Input for video name */
    #video-name-container {
      margin-top: 12px;
      background: #c0c0c0;
      border: 2px solid #000;
      box-shadow:
        3px 3px 0 #fff inset,
        -3px -3px 0 #404040 inset;
      border-radius: 4px;
      padding: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #video-name-label {
      user-select: none;
      font-weight: bold;
    }
    #video-name {
      flex-grow: 1;
      border: 2px inset #fff;
      background: #e0e0e0;
      color: #000;
      font-size: 1rem;
      padding: 4px;
      border-radius: 2px;
      user-select: text;
    }

    /* Responsive tweaks */
    @media (max-width: 480px) {
      #app {
        max-width: 100vw;
        width: 100vw;
        border-radius: 0;
        height: 100vh;
        box-sizing: border-box;
        padding: 6px;
      }
      #video-container {
        max-height: none;
        aspect-ratio: auto;
        height: 200px;
      }
      #controls {
        flex-wrap: wrap;
        gap: 6px;
      }
      button, input[type="range"], input[type="color"] {
        flex-grow: 1;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" role="alert" aria-live="assertive" aria-busy="true">
    <div id="loading-bar" aria-label="Barra de carga">
      <div id="loading-progress"></div>
    </div>
    Cargando...
  </div>

  <!-- Main App Container -->
  <main id="app" role="main" aria-label="Aplicación reproductor de video estilo clásico Windows XP">
    <div id="title-bar">Reproductor Clásico</div>

    <section id="video-container">
      <!-- VIDEO ELEMENT -->
      <video id="video" controls preload="metadata" tabindex="0" aria-label="Reproductor de video">
        <!--
          Aquí va el enlace del video (URL) que desees reproducir.
          Para cambiar el video, modifica el atributo 'src' a la URL deseada.
        -->
        <source id="video-source" src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4" />
        Tu navegador no soporta la etiqueta de video.
      </video>
    </section>

    <section id="controls" aria-label="Controles del reproductor">
      <button id="btn-backward" aria-label="Retroceder 10 segundos" title="Retroceder 10 segundos">&#9664;&#9664;</button>
      <button id="btn-play-pause" aria-label="Reproducir/Pausar" title="Reproducir/Pausar">&#9654;</button>
      <button id="btn-forward" aria-label="Adelantar 10 segundos" title="Adelantar 10 segundos">&#9654;&#9654;</button>

      <label for="volume-range" class="sr-only">Volumen</label>
      <input type="range" id="volume-range" min="0" max="1" step="0.05" aria-valuemin="0" aria-valuemax="1" aria-valuenow="1" aria-label="Control de volumen" title="Control de volumen" value="1" />

      <button id="btn-download" aria-label="Descargar video" title="Descargar video">&#128229;</button>

      <label for="color-picker" class="sr-only">Color de fondo del reproductor</label>
      <input type="color" id="color-picker" aria-label="Seleccionar color de fondo del reproductor" title="Cambiar color de fondo del reproductor" value="#000000" />
    </section>

    <section id="video-name-container" aria-label="Nombre del video">
      <label for="video-name" id="video-name-label">Nombre del video:</label>
      <input type="text" id="video-name" readonly aria-readonly="true" />
    </section>
    <p>
        <p>
    <Center> En prueba clip-video para que disfrute de tus videos anexado por la aplicación.</Center>
  </main>

  <script>
    // ====== Variables ======
    const loadingScreen = document.getElementById('loading-screen');
    const loadingProgress = document.getElementById('loading-progress');
    const app = document.getElementById('app');

    const video = document.getElementById('video');
    const videoSource = document.getElementById('video-source');
    const videoNameInput = document.getElementById('video-name');

    const btnPlayPause = document.getElementById('btn-play-pause');
    const btnBackward = document.getElementById('btn-backward');
    const btnForward = document.getElementById('btn-forward');
    const btnDownload = document.getElementById('btn-download');

    const volumeRange = document.getElementById('volume-range');
    const colorPicker = document.getElementById('color-picker');

    // ====== LocalStorage Keys ======
    const LS_KEYS = {
      videoSrc: 'videoSrc',
      videoName: 'videoName',
      volume: 'videoVolume',
      bgColor: 'videoBgColor'
    };

    // ====== Loading Screen Simulation ======
    function simulateLoading() {
      let progress = 0;
      return new Promise(resolve => {
        const interval = setInterval(() => {
          progress += Math.random() * 20; // increment randomly
          if (progress >= 100) {
            progress = 100;
            loadingProgress.style.width = progress + '%';
            clearInterval(interval);
            resolve();
          } else {
            loadingProgress.style.width = progress + '%';
          }
        }, 250);
      });
    }

    // ====== Load settings from localStorage or defaults ======
    function loadSettings() {
      // Video src
      const savedSrc = localStorage.getItem(LS_KEYS.videoSrc);
      if (savedSrc) {
        videoSource.src = savedSrc;
        video.load();
      }
      // Video name
      const savedName = localStorage.getItem(LS_KEYS.videoName);
      if (savedName) {
        videoNameInput.value = savedName;
      } else {
        videoNameInput.value = 'Video de ejemplo';
      }
      // Volume
      const savedVolume = localStorage.getItem(LS_KEYS.volume);
      if (savedVolume !== null) {
        const vol = parseFloat(savedVolume);
        video.volume = vol;
        volumeRange.value = vol;
        volumeRange.setAttribute('aria-valuenow', vol);
      } else {
        video.volume = 1;
        volumeRange.value = 1;
        volumeRange.setAttribute('aria-valuenow', 1);
      }
      // Background color
      const savedColor = localStorage.getItem(LS_KEYS.bgColor);
      if (savedColor) {
        video.style.backgroundColor = savedColor;
        colorPicker.value = savedColor;
      } else {
        video.style.backgroundColor = '#000000';
        colorPicker.value = '#000000';
      }
    }

    // ====== Save settings to localStorage ======
    function saveSettings() {
      localStorage.setItem(LS_KEYS.videoSrc, videoSource.src);
      localStorage.setItem(LS_KEYS.videoName, videoNameInput.value);
      localStorage.setItem(LS_KEYS.volume, video.volume.toString());
      localStorage.setItem(LS_KEYS.bgColor, video.style.backgroundColor);
    }

    // ====== Controls Handlers ======
    btnPlayPause.addEventListener('click', () => {
      if (video.paused) {
        video.play();
        btnPlayPause.innerHTML = '&#10074;&#10074;'; // Pause icon
        btnPlayPause.title = 'Pausar';
        btnPlayPause.setAttribute('aria-label', 'Pausar');
      } else {
        video.pause();
        btnPlayPause.innerHTML = '&#9654;'; // Play icon
        btnPlayPause.title = 'Reproducir';
        btnPlayPause.setAttribute('aria-label', 'Reproducir');
      }
    });

    btnBackward.addEventListener('click', () => {
      video.currentTime = Math.max(0, video.currentTime - 10);
    });

    btnForward.addEventListener('click', () => {
      video.currentTime = Math.min(video.duration, video.currentTime + 10);
    });

    volumeRange.addEventListener('input', () => {
      const vol = parseFloat(volumeRange.value);
      video.volume = vol;
      volumeRange.setAttribute('aria-valuenow', vol);
      saveSettings();
    });

    btnDownload.addEventListener('click', () => {
      // Descargar video (el enlace está en videoSource.src)
      // Crea un enlace temporal para descargar el video
      const a = document.createElement('a');
      a.href = videoSource.src;
      // Nombre de archivo basado en nombre del video o default
      let filename = videoNameInput.value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase();
      if (!filename) filename = 'video';
      // Añade extensión mp4 o intenta extraerla de la URL
      const urlExtMatch = videoSource.src.match(/\.(mp4|webm|ogg|mov|mkv|avi|flv)(\?|$)/i);
      const ext = urlExtMatch ? urlExtMatch[1] : 'mp4';
      a.download = filename + '.' + ext;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    colorPicker.addEventListener('input', () => {
      video.style.backgroundColor = colorPicker.value;
      saveSettings();
    });

    // ====== Video events ======
    video.addEventListener('play', () => {
      btnPlayPause.innerHTML = '&#10074;&#10074;'; // Pause icon
      btnPlayPause.title = 'Pausar';
      btnPlayPause.setAttribute('aria-label', 'Pausar');
    });
    video.addEventListener('pause', () => {
      btnPlayPause.innerHTML = '&#9654;'; // Play icon
      btnPlayPause.title = 'Reproducir';
      btnPlayPause.setAttribute('aria-label', 'Reproducir');
    });

    video.addEventListener('loadedmetadata', () => {
      // Guardar nombre basado en URL si no existe
      if (!localStorage.getItem(LS_KEYS.videoName)) {
        // Extraer nombre archivo de la URL
        try {
          const url = new URL(videoSource.src);
          let pathname = url.pathname;
          let fileName = pathname.substring(pathname.lastIndexOf('/') + 1);
          videoNameInput.value = fileName || 'Video sin nombre';
          saveSettings();
        } catch {
          videoNameInput.value = 'Video sin nombre';
          saveSettings();
        }
      }
    });

    // Prevent input editing since must be manipulated only from code source
    videoNameInput.addEventListener('keydown', e => {
      e.preventDefault();
    });

    // ====== Initialization ======
    async function init() {
      await simulateLoading();
      loadingScreen.style.display = 'none';
      app.style.display = 'flex';
      loadSettings();
    }

    // Run init on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <!-- Accessibility helper: hidden label for inputs -->
  <style>
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0,0,0,0) !important;
      border: 0 !important;
    }
  </style>
</body>
</html>
