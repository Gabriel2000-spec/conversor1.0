<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego Matem√°tico Educativo</title>
<style>
  /* Reset y fuentes */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0; padding: 0;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #fff;
    overflow-x: hidden;
  }
  .container {
    max-width: 480px;
    margin: auto;
    background: rgba(0,0,0,0.6);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    padding: 15px 20px;
  }

  /* Barra superior */
  .top-bar {
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.3);
    font-size: 0.9rem;
  }
  .info-item {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .info-item svg {
    width: 20px;
    height: 20px;
    fill: #ffd700;
  }

  /* Juego */
  .question-box {
    margin: 25px 0;
    font-size: 1.4rem;
    font-weight: 600;
    text-align: center;
    min-height: 50px;
  }

  /* Opciones de respuesta */
  .options {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
  }
  .option-btn {
    background: rgba(255,255,255,0.15);
    border: none;
    border-radius: 12px;
    color: #fff;
    padding: 12px 25px;
    font-size: 1.1rem;
    cursor: pointer;
    flex: 1 1 40%;
    max-width: 45%;
    transition: background-color 0.3s ease;
    position: relative;
    overflow: hidden;
    user-select: none;
  }
  .option-btn:hover {
    background: rgba(255,255,255,0.35);
  }
  .option-btn.correct {
    background-color: #4caf50 !important;
    box-shadow: 0 0 12px #4caf50;
  }
  .option-btn.incorrect {
    background-color: #f44336 !important;
    box-shadow: 0 0 12px #f44336;
  }

  /* Icono animado de operaci√≥n */
  .operation-icon {
    width: 40px;
    height: 40px;
    margin: 10px auto;
    animation: bounce 1s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0);}
    50% { transform: translateY(-10px);}
  }

  /* Medalla ganadora */
  .medal-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: rgba(255, 215, 0, 0.95);
    border-radius: 20px;
    padding: 40px 50px;
    box-shadow: 0 0 30px #ffd700;
    color: #222;
    font-weight: 700;
    font-size: 2rem;
    text-align: center;
    z-index: 9999;
    transition: transform 0.4s ease;
  }
  .medal-popup.show {
    transform: translate(-50%, -50%) scale(1);
  }
  .medal-icon {
    width: 80px;
    height: 80px;
    margin-bottom: 15px;
  }

  /* Bot√≥n regresar */
  .btn-menu {
    background: transparent;
    border: 2px solid #ffd700;
    color: #ffd700;
    padding: 10px 20px;
    border-radius: 15px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 10px;
    align-self: center;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .btn-menu:hover {
    background-color: #ffd700;
    color: #222;
  }

  /* Responsive para m√≥vil */
  @media (max-width: 500px) {
    .option-btn {
      flex: 1 1 100%;
      max-width: 100%;
    }
    .top-bar {
      font-size: 0.85rem;
    }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Bot√≥n de regresar al men√∫ -->
  <button class="btn-menu" id="btnMenu" title="Regresar al men√∫">‚Üê Men√∫</button>

  <!-- Barra superior de informaci√≥n -->
  <div class="top-bar" aria-label="Informaci√≥n del juego">
    <div class="info-item" id="pointsDisplay" title="Puntos">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 
      6.42 3.42 5 5.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5 18.58 5 20 6.42 
      20 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      <span id="points">0</span>
    </div>
    <div class="info-item" id="lostGamesDisplay" title="Juegos Perdidos">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 
      5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 
      17.59 13.41 12z"/></svg>
      <span id="lostGames">0</span>
    </div>
    <div class="info-item" id="coinsDisplay" title="Monedas">
      <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#ffd700" />
      <path d="M12 7v10m-2-5h4" stroke="#b8860b" stroke-width="2" stroke-linecap="round"/></svg>
      <span id="coins">0</span>
    </div>
    <div class="info-item" id="timerDisplay" title="Tiempo de Juego">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20c4.41 0 8-3.59 8-8s-3.59-8-8-8-8 
      3.59-8 8 3.59 8 8 8zm0-14v6l4 2"/></svg>
      <span id="timer">00:00</span>
    </div>
  </div>

  <!-- Icono de operaci√≥n animado -->
  <div id="operationIcon" class="operation-icon" aria-hidden="true"></div>

  <!-- Pregunta -->
  <div class="question-box" id="question" aria-live="polite"></div>

  <!-- Opciones -->
  <div class="options" id="options"></div>

  <!-- Medalla -->
  <div class="medal-popup" id="medalPopup" role="dialog" aria-modal="true" aria-labelledby="medalTitle" aria-describedby="medalDesc" tabindex="-1">
    <img src="" alt="Medalla" class="medal-icon" id="medalIcon" />
    <div id="medalTitle">¬°Ganaste!</div>
    <div id="medalDesc">Has conseguido una medalla especial.</div>
  </div>
</div>

<!-- Audio alarma -->
<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
(function() {
  // Variables y elementos
  const questionEl = document.getElementById('question');
  const optionsEl = document.getElementById('options');
  const pointsEl = document.getElementById('points');
  const lostGamesEl = document.getElementById('lostGames');
  const coinsEl = document.getElementById('coins');
  const timerEl = document.getElementById('timer');
  const operationIconEl = document.getElementById('operationIcon');
  const medalPopupEl = document.getElementById('medalPopup');
  const medalIconEl = document.getElementById('medalIcon');
  const alarmSound = document.getElementById('alarmSound');
  const btnMenu = document.getElementById('btnMenu');

  // Estado del juego
  let points = 0;
  let lostGames = 0;
  let coins = 0;
  let currentQuestion = null;
  let timerInterval = null;
  let secondsElapsed = 0;
  let questionsAsked = 0;

  // Configuraci√≥n
  const maxQuestions = 10;
  const operations = ['+', '-', '√ó', '√∑']; // s√≠mbolos para mostrar
  const operationIcons = {
    '+': `<svg viewBox="0 0 64 64" fill="#4caf50" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect x="28" y="12" width="8" height="40"/><rect x="12" y="28" width="40" height="8"/></svg>`,
    '-': `<svg viewBox="0 0 64 64" fill="#f44336" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect x="12" y="28" width="40" height="8"/></svg>`,
    '√ó': `<svg viewBox="0 0 64 64" stroke="#2196f3" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><line x1="16" y1="16" x2="48" y2="48"/><line x1="48" y1="16" x2="16" y2="48"/></svg>`,
    '√∑': `<svg viewBox="0 0 64 64" fill="#ff9800" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><circle cx="32" cy="16" r="6"/><rect x="12" y="28" width="40" height="8"/><circle cx="32" cy="48" r="6"/></svg>`
  };

  // Guardar y cargar datos en localStorage
  function saveGame() {
    const data = { points, lostGames, coins, secondsElapsed, questionsAsked };
    localStorage.setItem('mathGameData', JSON.stringify(data));
  }

  function loadGame() {
    const data = JSON.parse(localStorage.getItem('mathGameData'));
    if (data) {
      points = data.points || 0;
      lostGames = data.lostGames || 0;
      coins = data.coins || 0;
      secondsElapsed = data.secondsElapsed || 0;
      questionsAsked = data.questionsAsked || 0;
      updateInfo();
    }
  }

  // Actualizar barra superior
  function updateInfo() {
    pointsEl.textContent = points;
    lostGamesEl.textContent = lostGames;
    coinsEl.textContent = coins;
    timerEl.textContent = formatTime(secondsElapsed);
  }

  // Formatear segundos en mm:ss
  function formatTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2,'0');
    const s = (sec % 60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  // Generar pregunta aleatoria
  function generateQuestion() {
    // Elegir operaci√≥n al azar
    const op = operations[Math.floor(Math.random() * operations.length)];
    let a, b, answer;

    // Generar n√∫meros seg√∫n operaci√≥n para evitar decimales en divisi√≥n
    switch(op) {
      case '+':
        a = randInt(1, 50);
        b = randInt(1, 50);
        answer = a + b;
        break;
      case '-':
        a = randInt(1, 50);
        b = randInt(1, a); // para no tener negativo
        answer = a - b;
        break;
      case '√ó':
        a = randInt(1, 12);
        b = randInt(1, 12);
        answer = a * b;
        break;
      case '√∑':
        b = randInt(1, 12);
        answer = randInt(1, 12);
        a = b * answer; // para que sea divisible exacto
        break;
    }
    return { question: `${a}${op} ${b} = ?`, answer, op };
  }

  // N√∫mero aleatorio entero entre min y max inclusive
  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // Mostrar pregunta y opciones
  function showQuestion() {
    currentQuestion = generateQuestion();
    questionEl.textContent = currentQuestion.question;
    operationIconEl.innerHTML = operationIcons[currentQuestion.op];

    // Generar opciones: 1 correcta + 3 incorrectas
    const correct = currentQuestion.answer;
    let optionsSet = new Set();
    optionsSet.add(correct);

    while (optionsSet.size < 4) {
      let wrongOption = correct + randInt(-10, 10);
      if (wrongOption !== correct && wrongOption >= 0) {
        optionsSet.add(wrongOption);
      }
    }

    const optionsArr = Array.from(optionsSet).sort(() => Math.random() - 0.5);

    // Crear botones
    optionsEl.innerHTML = '';
    optionsArr.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.textContent = opt;
      btn.setAttribute('aria-label', `Respuesta ${opt}`);
      btn.addEventListener('click', () => selectAnswer(btn, opt));
      optionsEl.appendChild(btn);
    });
  }

  // Manejar selecci√≥n de respuesta
  function selectAnswer(btn, selected) {
    disableOptions();

    const isCorrect = selected === currentQuestion.answer;
    if (isCorrect) {
      btn.classList.add('correct');
      points += 10;
      coins += 1;
      questionsAsked++;
      saveGame();
      updateInfo();
      setTimeout(() => {
        if (questionsAsked >= maxQuestions) {
          showMedal('oro');
        } else {
          showQuestion();
        }
      }, 1200);
    } else {
      btn.classList.add('incorrect');
      lostGames++;
      questionsAsked++;
      saveGame();
      updateInfo();
      playAlarm();
      setTimeout(() => {
        if (questionsAsked >= maxQuestions) {
          showMedal('plata');
        } else {
          showQuestion();
        }
      }, 1200);
    }
  }

  // Deshabilitar botones para no seleccionar m√∫ltiples veces
  function disableOptions() {
    [...optionsEl.children].forEach(btn => btn.disabled = true);
  }

  // Mostrar medalla (oro, plata, bronce)
  function showMedal(type) {
    let medalSrc = '';
    let title = '';
    let desc = '';

    switch(type) {
      case 'oro':
        medalSrc = 'https://upload.wikimedia.org/wikipedia/commons/4/49/Gold_medal_icon.svg';
        title = '¬°Felicidades! Medalla de Oroüéâ';
        desc = 'Excelente desempe√±o, eres un campe√≥n.';
        break;
      case 'plata':
        medalSrc = 'https://upload.wikimedia.org/wikipedia/commons/9/95/Silver_medal_icon.svg';
        title = 'Medalla de Plata';
        desc = 'Buen esfuerzo, sigue practicando.‚òπÔ∏è';
        break;
      case 'bronce':
        medalSrc = 'https://upload.wikimedia.org/wikipedia/commons/2/23/Bronze_medal_icon.svg';
        title = 'Medalla de Bronce';
        desc = 'Sigue intentando, mejorar√°s.';
        break;
      default:
        medalSrc = '';
    }

    medalIconEl.src = medalSrc;
    medalIconEl.alt = title;
    document.getElementById('medalTitle').textContent = title;
    document.getElementById('medalDesc').textContent = desc;
    medalPopupEl.classList.add('show');
    medalPopupEl.focus();
  }

  // Cerrar medalla popup al click o tecla ESC
  medalPopupEl.addEventListener('click', () => {
    medalPopupEl.classList.remove('show');
    questionsAsked = 0;
    points = 0;
    lostGames = 0;
    coins = 0;
    secondsElapsed = 0;
    saveGame();
    updateInfo();
    showQuestion();
    startTimer();
  });

  document.addEventListener('keydown', (e) => {
    if (medalPopupEl.classList.contains('show') && (e.key === 'Escape' || e.key === 'Esc')) {
      medalPopupEl.classList.remove('show');
      questionsAsked = 0;
      points = 0;
      lostGames = 0;
      coins = 0;
      secondsElapsed = 0;
      saveGame();
      updateInfo();
      showQuestion();
      startTimer();
    }
  });

  // Alarma sonora al perder
  function playAlarm() {
    alarmSound.currentTime = 0;
    alarmSound.play();
  }

  // Temporizador
  function startTimer() {
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      secondsElapsed++;
      updateInfo();
      saveGame();
    }, 1000);
  }

  // Bot√≥n regresar al men√∫
  btnMenu.addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  // Inicializaci√≥n
  function init() {
    loadGame();
    updateInfo();
    showQuestion();
    startTimer();
  }

  init();

})();
</script>
</body>
</html>
